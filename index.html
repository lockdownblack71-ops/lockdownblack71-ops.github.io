<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eternal Tribe // Access Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0a0a0a; --fg:#e5ffe5; --accent:#00ffaa; --muted:#88ffcf; --bad:#ff7575; --line:#1b1b1b; }
    body { margin:0; font-family:monospace; background:var(--bg); color:var(--fg); text-align:center; padding:30px; }
    h1 { font-size:26px; margin-bottom:10px; }
    .card { background:#111; border:1px solid var(--line); border-radius:12px; padding:18px; margin:14px auto; max-width:480px; }
    input, button { padding:10px; font-size:16px; border-radius:8px; border:1px solid var(--line); margin-top:8px; }
    button { background:var(--accent); color:#000; font-weight:bold; cursor:pointer; }
    .msg { margin-top:10px; font-size:14px; }
    .msg.ok { color:var(--accent); }
    .msg.bad { color:var(--bad); }
    a.btn { display:inline-block; margin:6px; padding:10px 14px; border-radius:8px; background:var(--accent); color:#000; text-decoration:none; font-weight:bold; }
    a.btn.ghost { background:transparent; border:1px solid var(--line); color:var(--muted); }
    code { background:#060; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>‚ö° Eternal Tribe // Access Portal ‚ö°</h1>
  <p>Enter a code below, or join Discord to get one.</p>

  <div class="card">
    <h3>Unlock with Code</h3>
    <input id="codeInput" placeholder="Enter code (e.g. 6B2EJDKJM3)">
    <button id="unlockBtn">Unlock</button>
    <div id="unlockMsg" class="msg"></div>
    <div id="unlockedActions">
      <a class="btn" id="welcomeLink" target="_blank">üö™ Go to #welcome</a>
      <a class="btn ghost" id="inviteLink" target="_blank">üí¨ Join Discord</a>
      <p class="small">In Discord, run <code>!verify YOURCODE</code> in #welcome to claim your role.</p>
    </div>
  </div>

  <div class="card">
    <h3>Pick a Tier</h3>
    <p>Support via Ko-fi or PayPal & receive your code.</p>
    <a class="btn" href="http://ko-fi.com/theeternaltribe/tiers" target="_blank">üî• Flame / ‚öîÔ∏è Warrior ‚Äî Ko-fi</a>
    <a class="btn ghost" href="https://www.paypal.com/paypalme/theeternaltribe" target="_blank">üí≤ PayPal</a>
    <p><a href="https://ko-fi.com/theeternaltribe" target="_blank">üëÄ Browse our Ko-fi page</a></p>
  </div>

  <script>
    const API_URL = "https://theeternaltribe.theeternaltribe.repl.co/api/checkcode";
    const DISCORD_INVITE = "https://discord.gg/92sdve7x";
    const WELCOME_CHANNEL_LINK = "https://discord.com/channels/1416479764990136512/1416479765556232254";

    document.getElementById("welcomeLink").href = WELCOME_CHANNEL_LINK;
    document.getElementById("inviteLink").href = DISCORD_INVITE;

    async function unlock() {
      const input = document.getElementById("codeInput");
      const msg = document.getElementById("unlockMsg");
      const code = (input.value || "").trim();
      msg.className = "msg"; msg.textContent = "Checking‚Ä¶";

      if (!code) { msg.classList.add("bad"); msg.textContent = "‚ö†Ô∏è Enter a code."; return; }

      try {
        // POST first
        let r = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });
        if (!r.ok) throw new Error("POST failed");
        let data = await r.json();

        // Fallback: GET
        if (!("ok" in data)) {
          const g = await fetch(`${API_URL}?code=${encodeURIComponent(code)}`);
          data = await g.json();
        }

        if (data.ok) {
          msg.classList.add("ok");
          msg.innerHTML = `‚úÖ Valid code${data.tier ? ` <b>${data.tier}</b>` : ""}.<br>
          Next: click Welcome and run <code>!verify ${code.toUpperCase()}</code> in Discord.`;
        } else if (data.error === "used_code") {
          msg.classList.add("bad"); msg.textContent = "‚ö†Ô∏è That code was already used.";
        } else if (data.error === "invalid_code") {
          msg.classList.add("bad"); msg.textContent = "‚ùå Invalid code.";
        } else {
          msg.classList.add("bad"); msg.textContent = "‚ö†Ô∏è Error.";
        }
      } catch (e) {
        // GET fallback if POST errors
        try {
          const g = await fetch(`${API_URL}?code=${encodeURIComponent(code)}`);
          const data = await g.json();
          if (data.ok) {
            msg.classList.add("ok");
            msg.innerHTML = `‚úÖ Valid code${data.tier ? ` <b>${data.tier}</b>` : ""}.<br>
            Next: click Welcome and run <code>!verify ${code.toUpperCase()}</code> in Discord.`;
          } else {
            msg.classList.add("bad"); msg.textContent = "‚ùå Invalid or used code.";
          }
        } catch {
          msg.classList.add("bad");
          msg.textContent = "‚ö†Ô∏è Network/CORS error. If you have a code, click Welcome and verify inside Discord.";
        }
      }
    }

    document.getElementById("unlockBtn").addEventListener("click", unlock);
    document.getElementById("codeInput").addEventListener("keydown", e => { if (e.key === "Enter") unlock(); });
  </script>
</body>
</html>
